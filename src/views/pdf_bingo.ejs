<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Music Bingo - QRSong!</title>
<script src="https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.min.js"></script>
<style>
    @media print {
        @page {
            size: A4;
            margin: 0;
        }
        body {
            -webkit-print-color-adjust: exact !important;
            print-color-adjust: exact !important;
        }
        .page {
            page-break-after: always;
        }
        .page:last-child {
            page-break-after: auto;
        }
    }

    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }

    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: #ffffff;
    }

    .page {
        width: 210mm;
        height: 297mm;
        padding: 10mm;
        display: flex;
        flex-direction: column;
        position: relative;
    }

    .header {
        text-align: left;
        margin-bottom: 5mm;
    }

    .header .logo {
        display: block;
        height: 12mm;
        width: auto;
        margin-left: -3mm;
        margin-bottom: 4mm;
    }

    .header .subtitle {
        font-size: 14px;
        color: #666;
    }

    .header .round-info {
        font-size: 16px;
        font-weight: 600;
        margin-top: 2mm;
    }

    .bingo-grid {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        grid-template-rows: repeat(5, 1fr);
        gap: 2mm;
        width: 190mm;
        height: 190mm;
        margin: 5mm auto 0 auto;
    }

    .bingo-cell {
        border-radius: 4px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        padding: 2mm;
        overflow: hidden;
    }

    .bingo-cell {
        position: relative;
    }

    .bingo-cell .track-number {
        display: none;
    }

    .bingo-cell .song-title {
        font-size: 10px;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 1mm;
        line-height: 1.2;
        max-height: 2.4em;
        overflow: hidden;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
    }

    .bingo-cell .artist {
        font-size: 9px;
        color: #4b5563;
        margin-bottom: 1mm;
        line-height: 1.2;
        max-height: 1.2em;
        overflow: hidden;
        white-space: nowrap;
        text-overflow: ellipsis;
        width: 100%;
    }

    .bingo-cell.free-space .logo {
        width: 24mm;
        height: auto;
        max-height: 24mm;
        object-fit: contain;
    }

    .footer {
        text-align: center;
        margin-top: 5mm;
        padding-top: 3mm;
        border-top: 1px solid #e5e7eb;
    }

    .footer .branding {
        font-size: 11px;
        color: #9ca3af;
    }

    .footer .branding a {
        text-decoration: none;
    }

    /* QR Code positioning */
    .qr-container {
        position: absolute;
        top: 4mm;
        right: 7mm;
        width: 38mm;
        height: 38mm;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .qr-container img {
        width: 34mm;
        height: 34mm;
    }

    .qr-container .card-id {
        font-size: 9px;
        color: #666;
        margin-top: 1mm;
        text-align: center;
        font-weight: 600;
    }

    /* Add padding to header to avoid QR overlap */
    .header {
        padding-right: 45mm;
    }

    /* Round 1: Blue (classic bingo) */
    .round-1 .bingo-cell { border: 1.5px solid #1e40af; background: rgba(219, 234, 254, 0.5); }
    .round-1 .bingo-cell .year { color: #1e40af; font-size: 16px; font-weight: 700; }
    .round-1 .bingo-cell.free-space { background: #1e40af; }
    .round-1 .header .round-info { color: #1e40af; }
    .round-1 .footer .branding a { color: #1e40af; }

    /* Round 2: Red */
    .round-2 .bingo-cell { border: 1.5px solid #b91c1c; background: rgba(254, 226, 226, 0.5); }
    .round-2 .bingo-cell .year { color: #b91c1c; font-size: 16px; font-weight: 700; }
    .round-2 .bingo-cell.free-space { background: #b91c1c; }
    .round-2 .header .round-info { color: #b91c1c; }
    .round-2 .footer .branding a { color: #b91c1c; }

    /* Round 3: Green */
    .round-3 .bingo-cell { border: 1.5px solid #15803d; background: rgba(220, 252, 231, 0.5); }
    .round-3 .bingo-cell .year { color: #15803d; font-size: 16px; font-weight: 700; }
    .round-3 .bingo-cell.free-space { background: #15803d; }
    .round-3 .header .round-info { color: #15803d; }
    .round-3 .footer .branding a { color: #15803d; }

    /* Round 4: Yellow/Gold */
    .round-4 .bingo-cell { border: 1.5px solid #a16207; background: rgba(254, 249, 195, 0.5); }
    .round-4 .bingo-cell .year { color: #a16207; font-size: 16px; font-weight: 700; }
    .round-4 .bingo-cell.free-space { background: #a16207; }
    .round-4 .header .round-info { color: #a16207; }
    .round-4 .footer .branding a { color: #a16207; }

    /* Round 5: Orange */
    .round-5 .bingo-cell { border: 1.5px solid #c2410c; background: rgba(255, 237, 213, 0.5); }
    .round-5 .bingo-cell .year { color: #c2410c; font-size: 16px; font-weight: 700; }
    .round-5 .bingo-cell.free-space { background: #c2410c; }
    .round-5 .header .round-info { color: #c2410c; }
    .round-5 .footer .branding a { color: #c2410c; }

    /* Round 6: Purple */
    .round-6 .bingo-cell { border: 1.5px solid #7e22ce; background: rgba(243, 232, 255, 0.5); }
    .round-6 .bingo-cell .year { color: #7e22ce; font-size: 16px; font-weight: 700; }
    .round-6 .bingo-cell.free-space { background: #7e22ce; }
    .round-6 .header .round-info { color: #7e22ce; }
    .round-6 .footer .branding a { color: #7e22ce; }

    /* Round 7: Pink */
    .round-7 .bingo-cell { border: 1.5px solid #be185d; background: rgba(252, 231, 243, 0.5); }
    .round-7 .bingo-cell .year { color: #be185d; font-size: 16px; font-weight: 700; }
    .round-7 .bingo-cell.free-space { background: #be185d; }
    .round-7 .header .round-info { color: #be185d; }
    .round-7 .footer .branding a { color: #be185d; }

    /* Round 8: Teal */
    .round-8 .bingo-cell { border: 1.5px solid #0f766e; background: rgba(204, 251, 241, 0.5); }
    .round-8 .bingo-cell .year { color: #0f766e; font-size: 16px; font-weight: 700; }
    .round-8 .bingo-cell.free-space { background: #0f766e; }
    .round-8 .header .round-info { color: #0f766e; }
    .round-8 .footer .branding a { color: #0f766e; }

    /* Round 9: Brown */
    .round-9 .bingo-cell { border: 1.5px solid #78350f; background: rgba(254, 243, 199, 0.5); }
    .round-9 .bingo-cell .year { color: #78350f; font-size: 16px; font-weight: 700; }
    .round-9 .bingo-cell.free-space { background: #78350f; }
    .round-9 .header .round-info { color: #78350f; }
    .round-9 .footer .branding a { color: #78350f; }

    /* Round 10: Gray */
    .round-10 .bingo-cell { border: 1.5px solid #374151; background: rgba(243, 244, 246, 0.5); }
    .round-10 .bingo-cell .year { color: #374151; font-size: 16px; font-weight: 700; }
    .round-10 .bingo-cell.free-space { background: #374151; }
    .round-10 .header .round-info { color: #374151; }
    .round-10 .footer .branding a { color: #374151; }
</style>
</head>
<body>
<% sheets.forEach(function(sheet, index) { %>
<div class="page round-<%= sheet.round %>">
    <!-- QR Code for host verification -->
    <div class="qr-container">
        <div id="qr-<%= index %>"></div>
        <div class="card-id">R<%= sheet.round %> #<%= sheet.sheetNumber %></div>
    </div>

    <div class="header">
        <img src="<%= apiUri %>/assets/images/logo.png" alt="QRSong!" class="logo" />
        <div class="subtitle"><%= playlistName %></div>
        <div class="round-info"><%= t.roundInfo(sheet.round) %></div>
    </div>

    <div class="bingo-grid">
        <% sheet.grid.forEach(function(row) { %>
            <% row.forEach(function(cell) { %>
                <% if (cell.isFreeSpace) { %>
                    <div class="bingo-cell free-space">
                        <img src="<%= apiUri %>/assets/images/logo_white.png" alt="QRSong!" class="logo" />
                    </div>
                <% } else if (cell.track) { %>
                    <div class="bingo-cell">
                        <div class="track-number"><%= cell.track.bingoNumber %></div>
                        <div class="song-title"><%= cell.track.name %></div>
                        <div class="artist"><%= cell.track.artist %></div>
                        <div class="year"><%= cell.track.year %></div>
                    </div>
                <% } else { %>
                    <div class="bingo-cell">
                        <div class="song-title">-</div>
                    </div>
                <% } %>
            <% }); %>
        <% }); %>
    </div>

    <div class="footer">
        <div class="branding">
            <%= t.footerBranding %> <a href="https://qrsong.com">QRSong!</a> - <%= t.footerGenerator %>
        </div>
    </div>
</div>
<% }); %>

<script>
// Generate QR codes for each sheet
document.addEventListener('DOMContentLoaded', function() {
    var qrData = [
        <% sheets.forEach(function(sheet, index) { %>
        "<%= sheet.qrData %>"<%= index < sheets.length - 1 ? ',' : '' %>
        <% }); %>
    ];

    qrData.forEach(function(data, index) {
        var qr = qrcode(0, 'M');
        qr.addData(data);
        qr.make();
        var container = document.getElementById('qr-' + index);
        if (container) {
            container.innerHTML = qr.createImgTag(3, 0);
        }
    });
});
</script>
</body>
</html>
