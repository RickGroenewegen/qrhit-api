<%
// Font embedding for reliable PDF conversion
let fontStyles = '';
if (php.selectedFont && php.selectedFont !== 'Arial, sans-serif') {
    // Extract the font name before the comma
    let fontName = php.selectedFont.split(',')[0].trim().replace(/["']/g, '');
    let googleFontName = fontName.replace(/ /g, '+');
    let weights = typeof getGoogleFontWeights === 'function' ? getGoogleFontWeights(php.selectedFont) : '400;700';

    fontStyles = `
    <style>
        @import url('https://fonts.googleapis.com/css2?family=${googleFontName}:wght@${weights}&display=swap');

        body {
            font-family: '${fontName}', ${php.selectedFont.split(',').slice(1).join(',')}, Arial, sans-serif !important;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .text, .text.artist, .text.year, .text.name {
            font-family: '${fontName}', ${php.selectedFont.split(',').slice(1).join(',')}, Arial, sans-serif !important;
        }

        .text.year {
            font-family: '${fontName}', ${php.selectedFont.split(',').slice(1).join(',')}, Arial, sans-serif !important;
            font-weight: bold !important;
        }
    </style>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=${googleFontName}:wght@${weights}&display=swap" rel="stylesheet">
    `;
} else {
    fontStyles = `
    <style>
        body, .text, .text.artist, .text.year, .text.name {
            font-family: Arial, sans-serif !important;
        }
    </style>`;
}
%>
<%- fontStyles %>
